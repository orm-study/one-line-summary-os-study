## 주변 장치(I/O 디바이스, 저장 장치)

### 주변 장치 종류(캐릭터 디바이스, 블록 디바이스)

**데이터 전송 단위**가 **캐릭터**인지 **블록**인지에 따라 캐릭터 디바이스, 블록 디바이스로 분류

|  | 캐릭터 디바이스 | 블록 디바이스 |
| --- | --- | --- |
| 데이터 전송 단위 | 캐릭터(문자) | 블록(범위) |
| 데이터 전송 양 | 상대적으로 적은 양의 데이터 전송 | 상대적으로 많은 양의 데이터 전송 |
| 디바이스 종류 | 마우스, 키보드, 사운드 카드, 직렬/병렬 포트 | 하드 디스크, SSD, 그래픽 카드 |

### 주변 장치 내부 구조

- 버스 인터페이스
    - 주변 장치를 메인보드에 있는 **버스**로 연결하기 위한 인터페이스
- 외부 인터페이스
    - 각 하드웨어에 맞는 인터페이스
- 레지스터
    - 장치의 상태와 데이터를 보관할 수 있는 각종 레지스터
    - 입출력 작업 시 데이터 저장하고 CPU가 사용할 수 있도록 메모리로 이동되기도 함
- 컨트롤러
- 로직

### 버스

**컴퓨터 구성 요소 간 데이터를 전송하는 통로** 역할을 하는 전기적 연결 시스템

- 하나의 버스는 Address 버스, Data 버스, Control 버스로 구성

### 주변 장치를 하나의 버스로 연결했을 때 발생하는 문제

- **문제**

CPU가 작업 수행 중 I/O 명령이 발생하면 직접 입출력 장치에서 데이터를 가져왔다.

**입출력 중에는 다른 작업을 할 수 없었고**, CPU 사용률이 떨어졌다.

- **해결**

**입출력 제어기(I/O Controller), 여러 개의 버스 사용**

CPU는 I/O 명령을 만나면 입출력 제어기에게 입출력 작업을 맡기고, 다른 작업을 처리한다.

### 입출력 제어기가 사용하는 두 개 채널

- 시스템 버스
    - CPU와 메모리가 사용
    - 그래픽 카드의 경우, 다루는 데이터가 대용량이기 때문에 입출력 버스를 사용하지 않고 시스템 버스에 바로 연결해 사용
- 입출력 버스
    - 주변 장치가 사용
    - 느린 장치와 빠른 장치를 구분하기 위해 고속 입출력 버스와 저속 입출력 버스 사용하여 속도 차이로 인한 병목 현상 해결

### DMA(Direct Memory Access) 제어기

- **문제**

입출력 제어기는 입출력 버스에서 온 데이터를 메모리로 옮긴다.

메모리는 CPU의 명령으로 움직이기 때문에 입출력 제어기가 메모리에 접근하기 위해서는 CPU가 필요하다.

- **해결**

입출력 제어기가 CPU 도움을 받지 않고 메모리에 접근할 수 있도록 DMA 제어기가 추가됐다.

DMA를 통해 데이터를 직접 메모리에 저장하거나 가져올 수 있다.

### Memory Mapped I/O

CPU와 DMA가 사용하는 메모리가 겹치지 않도록 공간 분할

- 메모리
    - CPU가 사용하는 메모리 영역
- 입출력 메모리
    - DMA가 사용하는 메모리 영역

## 마우스/키보드

### 마우스 입력 처리 과정

1. 밑면에 있는 카메라가 표면을 향해 초당 1500회가 넘는 사진을 촬영하여 마우스 디바이스 컨트롤러 내 DSP(Digital Signal Processor)로 전달
2. DSP가 사진을 분석해서 마우스의 X축, Y축 좌표 움직임을 확인
3. DSP가 마우스의 움직임 및 클릭을 감지하면 디바이스 컨트롤러가 CPU에게 인터럽트 전달
4. 마우스 드라이버가 데이터 읽고, 운영체제에게 이벤트 신호 전달
5. 운영체제가 이벤트를 Foreground 애플리케이션으로 전달
6. 애플리케이션에서 마우스 동작을 처리

### 키보드 입력 처리 과정

1. 키 입력 시 **키보드 디바이스 컨트롤러**가 어떤 키가 입력됐는지 확인
2. 디바이스 컨트롤러 CPU에게 인터럽트 전달
3. **키보드 드라이버**가 운영체제에게 이벤트 신호 전달
4. 운영체제가 이벤트를 **Foreground 애플리케이션으로 이벤트 전달**
5. 애플리케이션에서 해당 키에 맞는 동작을 처리

## 하드 디스크(Hard Disk Drive, HDD)/Flash Memory(SSD)

### 하드 디스크가 느린 이유

- 헤드를 실린더로 이동시키는 데 걸리는 시간(Seek Time) 때문
- 헤드를 목표 지점까지 움직이려면 수 ms 소요, 다른 전자 장비의 경우 ns 단위 소요

|  | **HDD** | **SSD** |
| --- | --- | --- |
| 장점 | 저렴한 가격(용량 당 비용이 낮음) | 빠른 속도 |
|  | 대용량 가능 | 소음 없음 |
| 단점 | 느린 속도(Seek Time 발생) | 특정 지점에 데이터 덮어쓰기 불가능(똑같은 지점에 데이터를 쓰려면 기존 데이터를 지우고 새로 써야 함) |
|  | 소음 발생 | 지우기 가능 횟수가 정해져있음 |
|  | 스핀들처럼 회전축이 있어서 충격에 약함 |  |
|  | 자기적으로 처리되기 때문에 자석을 갖다대면 데이터 손상 발생 |  |

## 파일과 파일 시스템

- 운영체제는 파일 관리를 위해 파일 관리자를 사용한다. 파일 관리자가 파일 시스템이다.
- 파일 관리자는 파일 테이블을 이용해서 파일을 관리한다.

### 파일 시스템의 기능

1. 파일과 디렉터리 생성
2. 파일과 디렉터리 수정/삭제
3. 파일 접근 권한 관리
4. 무결성 보장
5. 백업과 복구
6. 암호화

### 파일 구성 요소

파일은 **헤더**와 **데이터**로 이루어져 있다.

- 헤더
    - 파일의 속성 포함(이름, 식별자, 유형, 크기, 시간, 저장 위치, 접근 권한, 소유자)

### 파일 제어 블록(File Control Block, FCB)

파일 제어 블록 = 파일 디스크립터

운영체제가 파일 관리를 위해 보관하는 정보다. 파일마다 독립적으로 존재한다.

### 파일 구조

파일에 있는 데이터 집합을 어떻게 구성하는지에 따라 순차 파일 구조, 직접 파일 구조, 인덱스 파일 구조 세 종류로 나눌 수 있다.

- **순차 파일 구조**
    - 파일 내용이 연속적으로 이어진 형태
    - 카세트 테이프
        - 원하는 노래를 듣기 위해 테이프 뒤로 감기 또는 앞으로 감기 필요
    - 파일
        - 파일의 부분 부터 읽기/쓰기를 하고 싶을 경우 lseek()로 파일 디스크립터의 위치 이동

| 장점 | 단점 |
| --- | --- |
| 순서대로 기록되기 때문에 공간 낭비 없음 | 특정 지점으로 바로 이동 불가 |
| 단순한 구조 | 삽입/삭제를 위한 탐색 시간 많이 듦 |
- **직접 파일 구조**
    - 해시 함수를 통해 저장 위치 결정

| 장점 | 단점 |
| --- | --- |
| 빠른 데이터 접근 | 저장 공간 낭비 |
- **인덱스 파일 구조**
    - 순차 접근과 직접 접근 방식의 장점을 취한 것
    - 음악 재생 프로그램의 재생 목록
        - 기본적으로 처음부터 마지막 곡까지 순차적으로 실행
        - 원하는 곡을 클릭하면 바로 실행 가능
            - 인덱스 테이블에서 해당 곡의 블록 번호를 찾아서 순차 데이터의 특정 위치로 이동

## 디렉터리

- 관련 있는 파일과 다른 디렉터리를 모아두는 공간
- 최상위 디렉터리 = 루트 디렉터리 = “/” or “C:”
- “.” 점 하나는 현재 디렉터리
- “..” 점 두 개는 상위 디렉터리, 루트 디렉터리의 경우 상위가 없기 때문에 점 두 개도 자기 자신을 가리킴

### 디렉터리 구조

- 순환이 있는 트리 구조
    - 디렉터리 트리 구조에서 순환이 발생하는 이유는 바로 가기 기능이 있기 때문

### 디렉터리 헤더

디렉터리 정보가 시작하는 위치를 가리킴

## 파일과 디스크

메모리에서 페이징 기법처럼 전체 디스크 공간을 일정 크기로 분할하고, 각 공간에 주소를 할당해 관리한다.

**일정한 크기로 나눈 공간**을 메모리에서는 페이지, **파일 시스템에서는 블록**이라고 부른다.

### 연속 할당

파일을 구성하는 블록들을 디스크에 연속적으로 저장

파일의 시작 블록만 알면 전체를 찾을 수 있음

### 불연속 할당

디스크의 빈 공간에 데이터를 분산 저장

- 불연속 할당 두 가지 방식
    - 연결 할당
        - 파일의 데이터를 연결리스트로 관리
    - 인덱스 할당
        - 파일 테이블의 블록 포인터를 데이터 블록에 직접 연결하는 것이 아닌 데이터의 인덱스를 가지고 있는 인덱스 블록에 연결
                

### Free Block List

디스크의 빈 공간 정보를 모아둔 리스트

특정 파일을 삭제하면 파일 시스템은 파일의 모든 정보를 지우는 것이 아닌, 파일 테이블의 헤더를 삭제하고 사용했던 블록들을 free block list에 추가한다.
